<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Mainframe AI Assistant</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            color: #A100FF;
        }

        .status {
            padding: 10px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            color: #155724;
            margin: 20px 0;
        }

        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .data-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .entry {
            padding: 15px;
            border-left: 4px solid #A100FF;
            margin: 10px 0;
            background: #f9f9f9;
        }

        .entry-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .entry-meta {
            font-size: 0.9em;
            color: #666;
        }

        button {
            background: #A100FF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background: #8800dd;
        }
    </style>
</head>
<body>
    <h1>üöÄ Mainframe AI Assistant - Test Page</h1>

    <div id="status" class="status">
        Checking application status...
    </div>

    <button onclick="testAPI()">Test API</button>
    <button onclick="loadData()">Load Mock Data</button>

    <div id="api-test" class="data-section">
        <h2>API Test Results</h2>
        <div id="api-results">Click "Test API" to check if the API is working</div>
    </div>

    <div id="data" class="data-section">
        <h2>Mock Data</h2>
        <div id="data-content">Click "Load Mock Data" to see the entries</div>
    </div>

    <script>
        // Mock data matching what's in App.tsx
        const mockData = [
            {
                id: '1',
                title: 'S0C4 ABEND in COBOL Program During Array Processing',
                problem: 'Program terminates with S0C4 protection exception when processing arrays',
                solution: 'Check OCCURS clause and verify array subscript bounds. Increase REGION size.',
                category: 'ABEND',
                usage_count: 45,
                success_count: 38,
                failure_count: 7
            },
            {
                id: '2',
                title: 'DB2 SQLCODE -818 Timestamp Mismatch',
                problem: 'Timestamp mismatch between DBRM and plan',
                solution: 'Rebind the package with current DBRM',
                category: 'DB2',
                usage_count: 32,
                success_count: 28,
                failure_count: 4
            },
            {
                id: '3',
                title: 'VSAM File Status 93',
                problem: 'Record not available for read',
                solution: 'Check file status and record locks',
                category: 'VSAM',
                usage_count: 19,
                success_count: 15,
                failure_count: 4
            }
        ];

        // Check if the mock API is initialized
        function checkStatus() {
            const statusEl = document.getElementById('status');

            if (window.electronAPI) {
                statusEl.textContent = '‚úÖ Mock Electron API is initialized and ready!';
                statusEl.className = 'status';
            } else {
                // Initialize mock API if not present
                window.electronAPI = {
                    kb: {
                        search: async (query) => {
                            await new Promise(r => setTimeout(r, 100));
                            if (!query) return { results: mockData };
                            const filtered = mockData.filter(e =>
                                e.title.toLowerCase().includes(query.toLowerCase()) ||
                                e.problem.toLowerCase().includes(query.toLowerCase())
                            );
                            return { results: filtered };
                        },
                        addEntry: async (data) => {
                            await new Promise(r => setTimeout(r, 100));
                            return { success: true };
                        }
                    }
                };

                statusEl.textContent = '‚ö†Ô∏è Mock API was not found - Initialized it now!';
                statusEl.className = 'status error';

                setTimeout(() => {
                    statusEl.textContent = '‚úÖ Mock Electron API is now initialized!';
                    statusEl.className = 'status';
                }, 1000);
            }
        }

        async function testAPI() {
            const resultsEl = document.getElementById('api-results');
            resultsEl.innerHTML = 'Testing API...';

            try {
                if (!window.electronAPI) {
                    throw new Error('API not initialized');
                }

                // Test search with empty query
                const allResults = await window.electronAPI.kb.search('');

                // Test search with specific query
                const filteredResults = await window.electronAPI.kb.search('COBOL');

                resultsEl.innerHTML = `
                    <p>‚úÖ API is working!</p>
                    <p>Total entries: ${allResults.results.length}</p>
                    <p>Search for "COBOL": ${filteredResults.results.length} result(s)</p>
                `;
            } catch (error) {
                resultsEl.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }

        function loadData() {
            const dataEl = document.getElementById('data-content');

            dataEl.innerHTML = mockData.map(entry => `
                <div class="entry">
                    <div class="entry-title">${entry.title}</div>
                    <div class="entry-meta">
                        Category: ${entry.category} |
                        Usage: ${entry.usage_count} times |
                        Success rate: ${Math.round((entry.success_count / entry.usage_count) * 100)}%
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Problem:</strong> ${entry.problem}<br>
                        <strong>Solution:</strong> ${entry.solution}
                    </div>
                </div>
            `).join('');
        }

        // Check status on load
        checkStatus();

        // Also check the main app URL
        fetch('http://localhost:3000/')
            .then(response => {
                if (response.ok) {
                    console.log('‚úÖ Main app is running at http://localhost:3000/');
                }
            })
            .catch(error => {
                console.warn('Main app may not be running:', error.message);
            });
    </script>
</body>
</html>